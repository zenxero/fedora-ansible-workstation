---

#
# extra-repos
#
# This task installs extra repos and packages on the system.
#

# Adding the flathub repo in this way seems to be broken at the moment
# https://stackoverflow.com/questions/73090882/ansible-added-flathub-repo-isnt-recognized
# https://github.com/ansible-collections/community.general/issues/3118
# - name: Add the flathub flatpak repository
#   community.general.flatpak_remote:
#     name: flathub
#     flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
#     method: system
#     state: present

- name: Add flathub repo manually
  ansible.builtin.command: flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

- name: Install the Flatseal package from flathub
  community.general.flatpak:
    name: com.github.tchx84.Flatseal
    state: present

- name: Install the ProtonUp-QT package from flathub
  community.general.flatpak:
    name: net.davidotek.pupgui2
    state: present

# Install Steam if the install_steam variable is true
- name: Install Steam
  when: install_steam
  block:

    - name: Install Steam
      ansible.builtin.dnf:
        name:
          - steam
          - steam-devices
          - gamemode
          - gamescope
        state: present
        update_cache: true

# Install Mangohud if the install_mangohud variable is true
- name: Install Mangohud
  when: install_mangohud
  block:

    - name: Install Mangohud
      ansible.builtin.dnf:
        name:
          - mangohud
          - mangohud.i686
          - goverlay
        state: present
        update_cache: true

# Install chrome if the install_chrome variable is true
- name: Install Chrome
  when: install_chrome
  block:

    - name: Import google chrome RPM GPG key
      ansible.builtin.rpm_key:
        state: present
        key: https://dl.google.com/linux/linux_signing_key.pub

    - name: Add google chrome repo
      ansible.builtin.yum_repository:
        name: google-chrome
        description: Google Chrome RPM Repo
        baseurl: https://dl.google.com/linux/chrome/rpm/stable/x86_64
        gpgkey: https://dl.google.com/linux/linux_signing_key.pub
        gpgcheck: true
        enabled: 1

    - name: Install google chrome
      ansible.builtin.dnf:
        name:
          - google-chrome-stable
        state: present
        update_cache: true

# Install edge if the install_edge variable is true
- name: Install MS Edge
  when: install_edge
  block:

    - name: Import edge RPM GPG key
      ansible.builtin.rpm_key:
        state: present
        key: https://packages.microsoft.com/keys/microsoft.asc

    - name: Add edge repo
      ansible.builtin.yum_repository:
        name: microsoft-edge
        description: Microsoft Edge RPM Repo
        baseurl: https://packages.microsoft.com/yumrepos/edge
        gpgkey: https://packages.microsoft.com/keys/microsoft.asc
        gpgcheck: true
        enabled: 1

    - name: Install edge
      ansible.builtin.dnf:
        name:
          - microsoft-edge-stable
        state: present
        update_cache: true

# Install thunderbird if the install_thunderbird variable is true
- name: Install Thunderbird
  when: install_thunderbird
  block:

    - name: Install Thunderbird
      ansible.builtin.dnf:
        name:
          - thunderbird
        state: present
        update_cache: true

# Install vscode if the install_vscode variable is true
- name: Install VSCode
  when: install_vscode
  block:

    - name: Import vscode RPM GPG key
      ansible.builtin.rpm_key:
        state: present
        key: https://packages.microsoft.com/keys/microsoft.asc

    - name: Add vscode repo
      ansible.builtin.yum_repository:
        name: vscode
        description: Visual Studio Code
        baseurl: https://packages.microsoft.com/yumrepos/vscode
        gpgkey: https://packages.microsoft.com/keys/microsoft.asc
        gpgcheck: true
        enabled: 1

    - name: Install vscode
      ansible.builtin.dnf:
        name:
          - code
        state: present
        update_cache: true

# Install vscodium if the install_vscodium variable is true
- name: Install VSCodium
  when: install_vscodium
  block:

    - name: Import vscodium RPM GPG key
      ansible.builtin.rpm_key:
        state: present
        key: https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/-/raw/master/pub.gpg

    - name: Add vscodium repo
      ansible.builtin.yum_repository:
        name: download.vscodium.com
        baseurl: https://download.vscodium.com/rpms/
        gpgkey: https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/-/raw/master/pub.gpg
        gpgcheck: true
        repo_gpgcheck: true
        enabled: 1

    - name: Install vscodium
      ansible.builtin.dnf:
        name:
          - codium
        state: present
        update_cache: true

# Install zenpower if the install_zenpower variable is true
- name: Install Zenpower
  when: install_zenpower
  block:

    - name: Enable zenpower copr repo
      community.general.copr:
        host: copr.fedorainfracloud.org
        name: birkch/zenpower3
        state: enabled

    - name: Install zenpower3
      ansible.builtin.dnf:
        name:
          - dkms-zenpower3
          - zenmonitor3
          - zenmonitor3-cli
        state: present
        update_cache: true

    - name: Add k10temp modprobe blacklist
      ansible.builtin.lineinfile:
        path: /etc/modprobe.d/dkms-zenpower3.conf
        line: blacklist k10temp
        create: true
        owner: root
        mode: 0644

# Install corectrl if the install_corectrl variable is true
- name: Install Corectrl
  when: install_corectrl
  block:

    - name: Install Corectrl
      ansible.builtin.dnf:
        name:
          - corectrl
        state: present
        update_cache: true

# Install solaar if the install_solaar variable is true
- name: Install Solaar
  when: install_solaar
  block:

    - name: Install solaar
      ansible.builtin.dnf:
        name:
          - solaar
          - solaar-udev
        state: present
        update_cache: true

# Install kdiskmark if the install_kdiskmark variable is true
- name: Install Kdiskmark
  when: install_kdiskmark
  block:

    - name: Install kdiskmark
      ansible.builtin.dnf:
        name:
          - kdiskmark
        state: present
        update_cache: true

# Install keepassxc if the install_keepassxc variable is true
- name: Install KeepassXC
  when: install_keepassxc
  block:

    - name: Install keepassxc
      ansible.builtin.dnf:
        name:
          - keepassxc
        state: present
        update_cache: true

# Install qemu/libvirt if the install_qemu variable is true
- name: Install QEMU and Libvirt
  when: install_qemu
  block:

    - name: Install QEMU
      ansible.builtin.dnf:
        name:
          - bridge-utils
          - genisoimage
          - guestfs-tools
          - libguestfs-tools
          - libvirt
          - libvirt-devel
          - qemu
          - qemu-kvm
          - spice-gtk-tools
          - swtpm
          - virt-install
          - virt-manager
          - virt-top
          - virt-viewer
        state: present
        update_cache: true

# Install gzdoom if the install_gzdoom variable is true
- name: Install GZDoom
  when: install_gzdoom
  block:

    - name: Enable gzdoom copr repo
      community.general.copr:
        host: copr.fedorainfracloud.org
        name: nalika/gzdoom
        state: enabled

    - name: Install gzdoom
      ansible.builtin.dnf:
        name:
          - gzdoom
        state: present
        update_cache: true

# Install dsda-doom if the install_dsdadoom variable is true
- name: Install dsda-doom
  when: install_dsdadoom
  block:

    - name: Enable dsda-doom copr repo
      community.general.copr:
        host: copr.fedorainfracloud.org
        name: alastortenebris/dsda-doom
        state: enabled

    - name: Install dsda-doom
      ansible.builtin.dnf:
        name:
          - dsda-doom
        state: present
        update_cache: true
